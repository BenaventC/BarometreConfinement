---
title: "Barometre du confinement : les acteurs et leur production"
author: "CB"
date: "31 mars 2020"
output:
  html_document: default
  word_document: default
---


Une collection de tweets mais quelle population? Quels acteurs?

Des analyse descriptive pour mieux cerner la population qui produit le flux des tweets collectés. 

# Les outils de l'analyse

A cette fin on utilise les packages suivant.

```{r setup, include=FALSE, echo=TRUE}
knitr::opts_chunk$set(echo = TRUE,include=TRUE, cache=TRUE, message=FALSE,warning=FALSE)
library(tidyverse) #l'environnement de base : données et visus
library(rtweet) #extraction twitter
library(gridExtra) #associer des ggplot
library(ggrepel) #pour une belle labelisation des xy
library(igraph) #pour l'analyse de réseau
library(wesanderson)
library(scales) #pour les échelles de temps et de date
library(syuzhet)     # ncr      
library(tm)
library(quanteda) #with quanteda

```

```{r Senti03}

#construire des dates jour/heures

df$day<-as.numeric(format(df$created_at, "%d")) # jour
df$month<-as.numeric(format(df$created_at, "%m")) # mois
df$hour<-as.numeric(format(df$created_at, "%H")) # heure
df$year<-2020 # heure


df<- df %>% mutate(Jour=ifelse(month == 3,day-16 ,ifelse(month==4,day+15,0) ))

ggplot(df,aes(x=Jour))+
  geom_bar(fill="gold4")+ 
  theme_minimal()+ 
  labs(title="# de tweets par jour")+
  facet_wrap(vars(is_retweet),ncol=1,scales="free")



#library(ggridges)

foo<-df %>% filter(Jour>1 & Jour<23)
foo$Jour<-as.factor(foo$Jour)

ggplot(foo,aes(x=hour, y=Jour))+theme_minimal() + 
  geom_density_ridges(scale=4, fill="pink") +
  labs(title = 'distribution du sentiment')


# par jour


ggplot(df,aes(x=month))+geom_bar(fill="firebrick")+theme_minimal()

ggplot(df,aes(x=hour))+geom_bar(fill="firebrick")+theme_minimal()+facet_wrap(vars(is_retweet),ncol=1,scales="free")

```

## Tweets et Retweets

Il est peut-être préférable d'enlever les retweets, pour ne garder que des contenus avec du texte original. 

Un developpement serait de reconstituter les chaines de tweets.

Mais d'abord une approche descriptive.

```{r capt2, include=TRUE, echo=FALSE}
#citations
ggplot(df,aes(x=is_quote))+geom_bar(fill="firebrick", position="stack")+theme_minimal()
#retweets
ggplot(df,aes(x=is_retweet))+geom_bar(fill="firebrick")+theme_minimal()
#device
#ggplot(df,aes(x=resource))+geom_bar(fill="firebrick")+theme_minimal()+coord_flip()
```

Examinons la distribution des indicateurs d'engagement, on selectionne les tweets qui ne sont ni des retweet ni des des quotes ni des réponses, donc les tweet primaires, ceux qui sont la racine d'une propagation. :


```{r tw01, }
library(scales)
foo<-df %>% filter (is_quote==TRUE & is_retweet==FALSE)

g1<-ggplot(foo,aes(x=favorite_count))+geom_histogram(fill="firebrick")+theme_minimal()+ scale_x_log10()+ scale_y_log10()
g1
g2<-ggplot(foo,aes(x=retweet_count))+geom_histogram(fill="firebrick")+theme_minimal()+ scale_x_log10() +scale_y_log10()
g2
g3<-ggplot(foo,aes(x=quote_count))+geom_histogram(fill="firebrick")+theme_minimal()
g3
g4<- ggplot(foo,aes(x=reply_count))+geom_histogram(fill="firebrick")+
  theme_minimal()
g4
g5<- ggplot(foo,aes(x=display_text_width ))+geom_bar( fill="firebrick")+
  theme_minimal()
g5
g6<- ggplot(df,aes(x=lang))+geom_bar(fill="firebrick")+
  theme_minimal()+ coord_flip()
g6
foo$media_type<- as.factor(foo$media_type)
g6<- ggplot(df,aes(x=media_type))+geom_bar(fill="firebrick")+
  theme_minimal()+ coord_flip()
g6

```

```{r capt4, include=TRUE, echo=FALSE}

df$month<-as.numeric(format(df$created_at, "%m")) # mois
ggplot(df,aes(x=month))+geom_bar(fill="firebrick")+theme_minimal()
df$hour<-as.numeric(format(df$created_at, "%H")) # heure
ggplot(df,aes(x=hour))+geom_bar(fill="firebrick")+theme_minimal()

df$year<-2020 # heure
df$day2<-as.factor(df$day)

```


## L' évolution quantitative des tweets

On retrace ici la production quotidiennes des tweets, rt quotes et reply. On notera qu'en journée l'échantillon représente plusieurs milliers d'observations à l'heure ce qui assure une grande sensibilité des mesures. On utilise [ts_plot](https://cran.r-project.org/web/packages/TSstudio/vignettes/Plotting_Time_Series.html).

On observe un effet d'usure, un rebond le dimanche, et un cycle quotidien. Aux premiers jours il semble qu'on postait plus le matin que le soir, après quelques jours la tendance s'est renversée.

```{r desc1}
## plot time series of tweets
ts_plot(foo, "1 hours", color="darkblue") +
  ggplot2::theme_minimal() +
  ggplot2::theme(plot.title = ggplot2::element_text(face = "bold")) +
  ggplot2::labs(
    x = NULL, y = NULL,
    title = "Fréquence des posts twitters sur #confinementjour",
    subtitle = "Nombre de tweets par heure",
    caption = "\nSource: Data collected by Benavent C. from Twitter's REST API via rtweet"
  )+ scale_x_datetime(date_breaks = "1 day", labels = scales::label_date_short())


```

